{"paragraphs":[{"text":"%pyspark\r\nfrom pyspark.sql.types import StructType\r\nfrom pyspark.sql.types import *\r\nfrom pyspark.ml.classification import LogisticRegression\r\nfrom pyspark.ml.feature import VectorAssembler\r\nfrom pyspark.ml import Pipeline\r\nfrom pyspark.ml.evaluation import BinaryClassificationEvaluator\r\nfrom pyspark.ml.classification import DecisionTreeClassifier\r\n\r\n\r\n# training = spark.read.format(\"libsvm\").load(\"/data/mllib/sample_libsvm_data.txt\")\r\n\r\nschema = StructType([\r\n    StructField(\"id\", StringType()),\r\n    StructField(\"name\", StringType()),\r\n    StructField(\"host_id\", StringType()),\r\n    StructField(\"host_name\", StringType()),\r\n    StructField(\"neighbourhood_group\", StringType()),\r\n    StructField(\"neighbourhood\", StringType()),\r\n    StructField(\"latitude\", FloatType()),\r\n    StructField(\"longitude\", FloatType()),\r\n    StructField(\"room_type\", StringType()),\r\n    StructField(\"price\", StringType()),\r\n    StructField(\"minimum_nights\", StringType()),\r\n    StructField(\"number_of_reviews\", StringType()),\r\n    StructField(\"last_review\", StringType()),\r\n    StructField(\"calculated_host_listings_count\", StringType()),\r\n    StructField(\"availability_365\", StringType()),\r\n])\r\nsourceDS = spark.read.csv(\r\n    \"/data/mllib/listings.csv\", header=True , schema = schema\r\n)\r\n\r\n# select latitude, longitude, neighbourhood_group from sourceDS and drop null # df = df.na.drop()\r\ndata = sourceDS.select(\"latitude\", \"longitude\", \"neighbourhood_group\").na.drop()\r\n\r\ncols = data.columns\r\n\r\nstages = []\r\n\r\nstage_1 = StringIndexer(inputCol= 'neighbourhood_group', outputCol= 'label')\r\n\r\n# specify the input and output columns of the vector assembler\r\nassembler = VectorAssembler(inputCols=['latitude',\r\n                                       'longitude'],\r\n                           outputCol='features')\r\n                    \r\n# final_data = assembler.transform(data)\r\n\r\n\r\nstages = [stage_1, assembler]\r\n\r\n\r\npipeline = Pipeline(stages = stages)\r\npipelineModel = pipeline.fit(data)\r\ndf = pipelineModel.transform(data)\r\nselectedCols = ['features','label'] + cols\r\n# df = df.selectExpr('features', 'neighbourhood_group as label')\r\ndf = df.select(selectedCols)\r\ndf.printSchema()\r\n# df.show()\r\n\r\n\r\n(trainingData, testData) = df.randomSplit([0.8, 0.2])\r\n\r\n# lr = LogisticRegression(maxIter=10, regParam=0.3, elasticNetParam=0.8)\r\n\r\n# # Fit the model\r\n# lrModel = lr.fit(trainingData)\r\n\r\n# predictions = lrModel.transform(testData)\r\n# predictions.select('latitude','longitude','neighbourhood_group','features', 'label', 'rawPrediction', 'prediction', 'probability').show(1000)\r\n\r\n# evaluator = BinaryClassificationEvaluator()\r\n# print('Test Area Under ROC', evaluator.evaluate(predictions))\r\n\r\n\r\ndt = DecisionTreeClassifier(featuresCol = 'features', labelCol = 'label', maxDepth = 1)\r\ndtModel = dt.fit(trainingData)\r\npredictions = dtModel.transform(testData)\r\npredictions.select('latitude','longitude','neighbourhood_group','features', 'label', 'rawPrediction', 'prediction', 'probability').show(100)\r\n\r\n\r\nevaluator = BinaryClassificationEvaluator()\r\nprint('Test Area Under ROC', evaluator.evaluate(predictions))\r\n","user":"anonymous","dateUpdated":"2020-01-04T19:04:14+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1578154800167_-137471358","id":"20200104-162000_601695211","dateCreated":"2020-01-04T16:20:00+0000","dateStarted":"2020-01-04T19:04:14+0000","dateFinished":"2020-01-04T19:04:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9476","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- features: vector (nullable = true)\n |-- label: double (nullable = true)\n |-- latitude: float (nullable = true)\n |-- longitude: float (nullable = true)\n |-- neighbourhood_group: string (nullable = true)\n\n+--------+---------+-------------------+--------------------+-----+--------------------+----------+--------------------+\n|latitude|longitude|neighbourhood_group|            features|label|       rawPrediction|prediction|         probability|\n+--------+---------+-------------------+--------------------+-----+--------------------+----------+--------------------+\n| 1.24992|103.82441|     Central Region|[1.24992001056671...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.26603|103.81693|     Central Region|[1.26602995395660...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n|  1.2667|103.81127|     Central Region|[1.26670002937316...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n|  1.2693|103.82509|     Central Region|[1.26929998397827...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27013|103.82044|     Central Region|[1.27013003826141...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27282|103.80743|     Central Region|[1.27281999588012...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27283|103.83222|     Central Region|[1.27283000946044...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27289|103.83256|     Central Region|[1.27288997173309...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27291| 103.8338|     Central Region|[1.27290999889373...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n|  1.2732|103.84483|     Central Region|[1.27320003509521...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27331|103.84422|     Central Region|[1.27330994606018...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27345|103.84389|     Central Region|[1.27345001697540...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27349|103.84357|     Central Region|[1.27348995208740...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n|  1.2735|103.84529|     Central Region|[1.27349996566772...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n|  1.2735|103.84547|     Central Region|[1.27349996566772...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27367|103.83367|     Central Region|[1.27366995811462...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27369|103.83393|     Central Region|[1.27368998527526...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n|  1.2739| 103.8445|     Central Region|[1.27390003204345...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n|  1.2739|103.84506|     Central Region|[1.27390003204345...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27391|103.84369|     Central Region|[1.27391004562377...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27434|103.83583|     Central Region|[1.27434003353118...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27436| 103.8345|     Central Region|[1.27435994148254...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27439|103.84083|     Central Region|[1.27438998222351...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27444|103.83659|     Central Region|[1.27444005012512...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27445|103.83427|     Central Region|[1.27444994449615...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27462|103.84248|     Central Region|[1.27462005615234...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27475|103.84374|     Central Region|[1.27474999427795...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27475|103.84499|     Central Region|[1.27474999427795...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27476|103.84362|     Central Region|[1.27476000785827...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27478|103.84369|     Central Region|[1.27478003501892...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27479|103.83694|     Central Region|[1.27479004859924...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27483|103.84361|     Central Region|[1.27482998371124...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27495|   103.84|     Central Region|[1.27495002746582...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27498|103.84549|     Central Region|[1.27497994899749...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27509|103.84534|     Central Region|[1.27508997917175...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27513|103.81075|     Central Region|[1.27513003349304...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27516| 103.8453|     Central Region|[1.27515995502471...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27518|103.84443|     Central Region|[1.27517998218536...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27523|103.84536|     Central Region|[1.27523005008697...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27527| 103.7918|     Central Region|[1.27526998519897...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27537|103.84564|     Central Region|[1.27537000179290...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27538|103.84635|     Central Region|[1.27538001537323...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n|  1.2754|103.84358|     Central Region|[1.27540004253387...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n|  1.2754|103.84705|     Central Region|[1.27540004253387...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27546|103.84014|     Central Region|[1.27546000480651...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27546|103.84528|     Central Region|[1.27546000480651...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27547|103.84558|     Central Region|[1.27547001838684...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27548|103.84444|     Central Region|[1.27548003196716...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27551|103.84276|     Central Region|[1.27550995349884...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27551|103.84515|     Central Region|[1.27550995349884...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27555|103.84533|     Central Region|[1.27555000782012...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27556|103.84409|     Central Region|[1.27556002140045...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27561|103.84362|     Central Region|[1.27560997009277...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27566|103.83671|     Central Region|[1.27566003799438...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27571|103.84531|     Central Region|[1.27570998668670...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27571|103.84541|     Central Region|[1.27570998668670...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27574|103.83632|     Central Region|[1.27574002742767...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n|  1.2758|103.84567|     Central Region|[1.27579998970031...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27596|103.84433|     Central Region|[1.27595996856689...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n|  1.2761|103.83613|     Central Region|[1.27610003948211...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27616|103.83657|     Central Region|[1.27616000175476...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27635|103.83898|     Central Region|[1.27635002136230...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27641|103.84087|     Central Region|[1.27640998363494...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27648|103.83792|     Central Region|[1.27647995948791...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27655|103.84888|     Central Region|[1.27655005455017...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27674|103.85535|     Central Region|[1.27673995494842...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27691| 103.8456|     Central Region|[1.27690994739532...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27707|103.84501|     Central Region|[1.27707004547119...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27707|103.84808|     Central Region|[1.27707004547119...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27713|103.83199|     Central Region|[1.27713000774383...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27718|103.80808|     Central Region|[1.27717995643615...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27734|103.84902|     Central Region|[1.27734005451202...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27744| 103.7886|     Central Region|[1.27743995189666...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27749|103.84238|     Central Region|[1.27749001979827...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27764|103.84373|     Central Region|[1.27763998508453...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27777|103.85649|     Central Region|[1.27777004241943...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n|  1.2779|103.84976|     Central Region|[1.27789998054504...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27799|103.84931|     Central Region|[1.27798998355865...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27809|103.82065|     Central Region|[1.27809000015258...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27811|103.83379|     Central Region|[1.27811002731323...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27843|103.84614|     Central Region|[1.27842998504638...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27846|103.83768|     Central Region|[1.27846002578735...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27861|103.85142|     Central Region|[1.27860999107360...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27875|103.85505|     Central Region|[1.27874994277954...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27885|103.85292|     Central Region|[1.27884995937347...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27933| 103.7874|     Central Region|[1.27933001518249...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27943|103.78543|     Central Region|[1.27943003177642...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27948|103.78768|     Central Region|[1.27947998046875...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27955|103.78502|     Central Region|[1.27954995632171...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27962|103.83986|     Central Region|[1.27962005138397...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27964| 103.7856|     Central Region|[1.27963995933532...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27965| 103.8404|     Central Region|[1.27964997291564...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27968| 103.8483|     Central Region|[1.27968001365661...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27974|103.84091|     Central Region|[1.27973997592926...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27976|103.78593|     Central Region|[1.27976000308990...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n|  1.2798|103.84095|     Central Region|[1.27980005741119...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27991|103.81808|     Central Region|[1.27990996837615...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.27999|103.85313|     Central Region|[1.27998995780944...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.28002|103.84027|     Central Region|[1.28001999855041...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n| 1.28006|103.85371|     Central Region|[1.28006005287170...|  0.0|[4915.0,118.0,289...|       0.0|[0.92352499060503...|\n+--------+---------+-------------------+--------------------+-----+--------------------+----------+--------------------+\nonly showing top 100 rows\n\n('Test Area Under ROC', 0.8206944818995517)\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=1045","http://172.17.0.2:4040/jobs/job?id=1046","http://172.17.0.2:4040/jobs/job?id=1047","http://172.17.0.2:4040/jobs/job?id=1048","http://172.17.0.2:4040/jobs/job?id=1049","http://172.17.0.2:4040/jobs/job?id=1050","http://172.17.0.2:4040/jobs/job?id=1051","http://172.17.0.2:4040/jobs/job?id=1052","http://172.17.0.2:4040/jobs/job?id=1053"],"interpreterSettingId":"spark"}}},{"user":"anonymous","dateUpdated":"2020-01-04T17:17:12+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1578154956288_-771068201","id":"20200104-162236_164935023","dateCreated":"2020-01-04T16:22:36+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9477"}],"name":"BigDataAssignment","id":"2EXU2KHCU","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}